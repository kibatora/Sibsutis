% --- Задание 3: Матрица переходов ---

L = 15;
T = zeros(L, L);

% Заполняем ненулевые элементы матрицы T, соблюдая условия:
% Минимум 3 исходящих и 1 входящий маршрут для каждого узла

T(1, [2 5 8]) = 1/3;   % Из узла 1 переходы в 2, 5, 8 с равной вероятностью
T(2, [1 7 12]) = 1/3;  % Из узла 2 переходы в 1, 7, 12
T(3, [2 9 14]) = 1/3;  % Из узла 3 переходы в 2, 9, 14
T(4, [3 10 15]) = 1/3; % Из узла 4 переходы в 3, 10, 15
T(5, [1 6 11]) = 1/3;  % Из узла 5 переходы в 1, 6, 11
T(6, [5 12 2]) = 1/3;  % Из узла 6 переходы в 5, 12, 2
T(7, [2 8 13]) = 1/3;  % Из узла 7 переходы в 2, 8, 13
T(8, [1 7 9]) = 1/3;   % Из узла 8 переходы в 1, 7, 9
T(9, [3 8 10]) = 1/3;  % Из узла 9 переходы в 3, 8, 10
T(10, [4 9 11]) = 1/3; % Из узла 10 переходы в 4, 9, 11
T(11, [5 10 12]) = 1/3;% Из узла 11 переходы в 5, 10, 12
T(12, [2 6 13]) = 1/3; % Из узла 12 переходы в 2, 6, 13
T(13, [7 12 14]) = 1/3;% Из узла 13 переходы в 7, 12, 14
T(14, [3 13 15]) = 1/3;% Из узла 14 переходы в 3, 13, 15
T(15, [4 11 1]) = 1/3; % Из узла 15 переходы в 4, 11, 1

% --- Задание 6: Проверка стохастичности ---

if stochastic(T)
  disp('Матрица переходов является стохастической.')
else
  disp('Матрица переходов не является стохастической.')
end

% --- Задание 7: Проверка эргодичности ---

e = 1e-6; % Допустимая погрешность
if ergodic(T, e)
  disp('Цепь Маркова является эргодической.')
else
  disp('Цепь Маркова не является эргодической.')
end

% --- Задание 4: Функция stochastic() ---
function isStochastic = stochastic(matrix)
  % Проверка, является ли матрица стохастической
  isStochastic = all(sum(matrix, 2) == 1); 
end

% --- Задание 5: Функция ergodic() ---
function isErgodic = ergodic(matrix, e)
  % Проверка, является ли цепь Маркова эргодической
  % e - допустимая погрешность

  [V, D] = eig(matrix'); 
  [~, idx] = max(diag(D)); 
  pi = V(:, idx) / sum(V(:, idx)); 

  isErgodic = all(pi > e);
end
